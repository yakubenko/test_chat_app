!function(e){function s(s){for(var n,r,i=s[0],l=s[1],c=s[2],g=0,d=[];g<i.length;g++)r=i[g],a[r]&&d.push(a[r][0]),a[r]=0;for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n]);for(u&&u(s);d.length;)d.shift()();return o.push.apply(o,c||[]),t()}function t(){for(var e,s=0;s<o.length;s++){for(var t=o[s],n=!0,i=1;i<t.length;i++){var l=t[i];0!==a[l]&&(n=!1)}n&&(o.splice(s--,1),e=r(r.s=t[0]))}return e}var n={},a={0:0},o=[];function r(s){if(n[s])return n[s].exports;var t=n[s]={i:s,l:!1,exports:{}};return e[s].call(t.exports,t,t.exports,r),t.l=!0,t.exports}r.m=e,r.c=n,r.d=function(e,s,t){r.o(e,s)||Object.defineProperty(e,s,{enumerable:!0,get:t})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,s){if(1&s&&(e=r(e)),8&s)return e;if(4&s&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(r.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&s&&"string"!=typeof e)for(var n in e)r.d(t,n,function(s){return e[s]}.bind(null,n));return t},r.n=function(e){var s=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(s,"a",s),s},r.o=function(e,s){return Object.prototype.hasOwnProperty.call(e,s)},r.p="/test/webroot/js/dist/";var i=window.webpackJsonp=window.webpackJsonp||[],l=i.push.bind(i);i.push=s,i=i.slice();for(var c=0;c<i.length;c++)s(i[c]);var u=l;o.push([36,1]),t()}({2:function(e,s,t){var n=t(32);"string"==typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);(0,t(37).default)("30b7042f",n,!0,{})},31:function(e,s,t){"use strict";var n=t(2);t.n(n).a},32:function(e,s,t){(e.exports=t(33)(!1)).push([e.i,"div.messages {\n  min-height: 350px;\n  max-height: 350px;\n  padding: 18px;\n  border: solid 1px #d3d3d3;\n  border-radius: 10px;\n  overflow-x: hidden;\n  overflow-y: scroll;\n}\n",""])},36:function(e,s,t){"use strict";t.r(s);var n=t(6),a=t(3),o=t.n(a),r={name:"ChatRoomInput",data:function(){return{message:""}},methods:{sendMessage:function(){""!==this.message&&(this.$emit("send-message",this.message),this.message="")}}},i=t(1),l=Object(i.a)(r,function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"row"},[t("div",{staticClass:"col-10"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.message,expression:"message"}],staticClass:"col-12",attrs:{type:"text"},domProps:{value:e.message},on:{keyup:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.sendMessage(s)},input:function(s){s.target.composing||(e.message=s.target.value)}}})]),e._v(" "),t("div",{staticClass:"col-2"},[t("span",{staticClass:"btn btn-primary",on:{click:e.sendMessage}},[e._v("\n            Отправить\n        ")])])])},[],!1,null,null,null).exports,c={name:"MessageItem",props:{message:{type:Object,required:!0}}},u={name:"ChatRoom",components:{ChatRoomInput:l,MessagesItem:Object(i.a)(c,function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"mb-2 border-bottom"},[e._v("\n    "+e._s(e.message.id)+"\n    "),t("span",{staticClass:"badge badge-secondary"},[e._v(e._s(e.message.user.login))]),e._v("\n    "+e._s(e.message.message)+"\n\n    "),t("br"),e._v(" "),t("span",{staticClass:"text-muted"},[e._v(e._s(e.message.created_at))])])},[],!1,null,null,null).exports},data:function(){return{message:"",messages:[],interval:null,lastId:null,prefix:"/test"}},mounted:function(){this.getMessages()},methods:{getMessages:function(){var e=this;o.a.get(this.prefix+"/get_messages.php").then(function(s){var t=s.data.reverse();e.lastId=t[t.length-1].id,e.$set(e,"messages",t),e.$nextTick(function(){e.scrollMessages(),e.interval=setInterval(e.getLatestMessages,1e3)})}).catch(function(e){console.log(e)})},getLatestMessages:function(){var e=this;o.a.get(this.prefix+"/get_messages.php?last_id="+this.lastId).then(function(s){if(s.data.length>0){console.log(s);var t=s.data.reverse();e.lastId=t[t.length-1].id,e.$set(e,"messages",e.messages.concat(t)),e.$nextTick(function(){e.scrollMessages()})}}).catch(function(e){console.log(e)})},sendMessage:function(e){var s=this;e.length>=2&&o.a.post("/test/add_message.php",{message:e}).then(function(e){console.log(e),s.getLatestMessages()}).catch(function(e){console.log(e)})},scrollMessages:function(){var e=this.$refs.messagesDiv.scrollHeight;this.$refs.messagesDiv.scrollTop=e+100}}},g=(t(31),Object(i.a)(u,function(){var e=this.$createElement,s=this._self._c||e;return s("div",{staticClass:"col-12"},[s("div",{staticClass:"row"},[s("div",{ref:"messagesDiv",staticClass:"col-12 messages mb-3"},this._l(this.messages,function(e,t){return s("messages-item",{key:t,attrs:{message:e}})}),1)]),this._v(" "),s("chat-room-input",{on:{"send-message":this.sendMessage}})],1)},[],!1,null,null,null).exports);n.a.config.productionTip=!1,new n.a({el:"#chatRoom",components:{ChatRoom:g}})}});